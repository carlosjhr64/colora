#!/usr/bin/env ruby
require 'colora'

def parse_argv
  require 'help_parser'
  options = HelpParser[Colora::VERSION, <<~HELP]
    Usage:
      colora [:options+] [<file=FILE>]
    Options:
      -q --quiet
      -g --green   \t Skip red:   /^[-<]/
      -r --red     \t Skip green: /^[+>]/
      -c --code    \t Show only new(changed) code
      -d --dup     \t Show only duplicate code
      -C --comment \t Show only new(changed) comments
      -G --git     \t Run git-diff
      -t --tab     \t Swap tab with â‡¥
      --theme=NAME \t Rouge theme(default: #{Colora.theme})
      --lang=NAME  \t Language being diffed(default: #{Colora.lang})
    Types:
      FILE /^[-\\w\\.\\/]+$/
      NAME /^[\\d.a-z_]+$/
    Exclusive:
      green red
    # Notes: #
    When no FILE is given and STDIN in a TTY, git-diff is run.
    Known themes:
      base16 base16.monokai base16.solarized bw
      colorful
      github gruvbox
      igorpro
      magritte molokai monokai monokai.sublime
      pastie
      thankful_eyes tulip
  HELP
  # FILE:
  Colora.file = options.file if options.file
  # Options:
  Colora.filter << 'q' if options.quiet?
  Colora.filter << '+' if options.green?
  Colora.filter << '-' if options.red?
  Colora.filter << 'c' if options.code?
  Colora.filter << 'd' if options.dup?
  Colora.filter << 'C' if options.comment?
  Colora.theme = options.theme if options.theme?
  Colora.lang = options.lang if options.lang?
  Colora.git = options.git?
  Colora.tab = options.tab?
end

parse_argv unless ARGV.empty?
Colora.git = true if $stdin.tty? && !Colora.file

begin
  Colora.run
rescue Colora::Error => e
  warn e.message
end
