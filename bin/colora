#!/usr/bin/env ruby
require 'colora'

def parse_argv
  require 'help_parser'
  options = HelpParser[Colora::VERSION, <<~HELP]
    Usage:
      colora [:options+] [<file=FILE>]
    Options:
      -q --quiet
      -g --green   \t Skip red:   /^[-<]/
      -r --red     \t Skip green: /^[+>]/
      -c --code    \t Show only new(changed) code
      -d --dup     \t Show only duplicat code
      -G --git     \t Run git-diff
      --lang=WORD  \t Language being diffed
    Types:
      FILE /^[-\\w\\.\\/]+$/
      WORD /^\\w+$/
    Exclusive:
      green red
  HELP
  # FILE:
  Colora.file = options.file if options.file
  # Options:
  Colora.filter << 'q' if options.quiet?
  Colora.filter << 'r' if options.green?
  Colora.filter << 'a' if options.red?
  Colora.filter << 'c' if options.code?
  Colora.filter << 'd' if options.dup?
  Colora.lang = options.lang if options.lang?
  Colora.git = options.git?
end
parse_argv unless ARGV.empty?
begin
  Colora.run
rescue Colora::Error => e
  warn e.message
end
